<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STEM 11 Aurora - Student Portal</title>
<style>
  :root{
    --bg:#f3fbff;
    --accent:#bfe9ff;
    --deep:#6fb8e6;
    --text:#123;
    --muted:#4b6b80;
    --white:#ffffff;
    --card-shadow: 0 6px 18px rgba(18,55,90,0.08);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{margin:0;background:linear-gradient(180deg,var(--bg),#e9f7ff);color:var(--text);}
  header{display:flex;align-items:center;gap:12px;padding:18px 24px;background:linear-gradient(90deg,var(--white),rgba(255,255,255,0.6));box-shadow:var(--card-shadow);position:sticky;top:0;z-index:20}
  header img.logo{width:64px;height:64px;object-fit:contain;border-radius:8px}
  .school-title{line-height:1}
  .school-title h1{margin:0;font-size:1.25rem;color:var(--deep)}
  .school-title p{margin:0;font-size:0.95rem;color:var(--muted)}
  main{max-width:1100px;margin:28px auto;padding:16px}
  .card{background:var(--white);border-radius:12px;padding:20px;box-shadow:var(--card-shadow);margin-bottom:18px}
  .center{display:flex;justify-content:center;align-items:center}
  .login-box{max-width:520px;margin:18px auto;padding:28px;border-radius:12px}
  label{display:block;margin-bottom:6px;font-weight:600;color:var(--muted)}
  input[type="text"], input[type="password"], input[type="number"], select{
    width:100%;padding:10px;border-radius:8px;border:1px solid #d7eefb;background:linear-gradient(180deg,#fcfeff,#f4fbff);font-size:15px;box-sizing:border-box
  }
  button{background:var(--deep);color:var(--white);border:none;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .muted{color:var(--muted);font-size:0.95rem}
  .small{font-size:0.9rem}
  .linklike{background:none;border:0;color:var(--deep);cursor:pointer;text-decoration:underline;font-weight:600}
  .grid{display:grid;gap:12px}
  .grid.cols-2{grid-template-columns:1fr 1fr}
  .section-list button{display:block;width:100%;text-align:left;padding:12px;border-radius:8px;border:1px dashed #dfeff7;background:transparent;cursor:pointer}
  .student-row{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:8px;border-bottom:1px solid #f1f7fb}
  .student-row .name{font-weight:600}
  .student-row .lrn{font-size:0.9rem;color:var(--muted)}
  .actions{display:flex;gap:8px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border:1px solid #edf6fb;text-align:left;font-size:14px}
  th{background:linear-gradient(90deg,#f7fdff,#eefcff);font-weight:700}
  footer{padding:20px;text-align:center;color:var(--muted);font-size:0.9rem}
  .notice{padding:10px;border-radius:8px;background:#e6fbff;border:1px solid #bfe8ff;color:#0b486c}
  .tag{display:inline-block;padding:6px 8px;border-radius:999px;background:#f0fbff;color:var(--deep);font-weight:700;border:1px solid #d0eefc}
  .top-actions{display:flex;gap:12px;align-items:center; justify-content:flex-end}
  .right{margin-left:auto}
  .hidden{display:none}
  .msg-pass{color:green;font-weight:700}
  .msg-fail{color:#b84a3c;font-weight:700}
  .first-quarter{font-family: "Georgia", serif; font-size:1.05rem; color:var(--deep); margin-top:12px}
  .admin-area{margin-top:12px}
  .btn-ghost{background:transparent;border:1px solid #d0eefc;color:var(--deep);padding:8px;border-radius:8px}
  .small-muted{font-size:0.85rem;color:var(--muted)}
  input.grade{width:80px}
  .save-btn{background:#2a9df4}
  .logout-btn{background:#f36f6f}
  @media(max-width:720px){
    header{padding:12px}
    .school-title h1{font-size:1rem}
    .school-title p{font-size:0.85rem}
    .grid.cols-2{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<header>
  <img class="logo" src="https://drive.google.com/uc?export=view&id=1_T4_-2ufDacbCf7u2vKP8mkMGG9-Tmjm" alt="School logo">
  <div class="school-title">
    <h1>Dimasalang National High School</h1>
    <p>Dimasalang, Masbate</p>
  </div>
  <div class="top-actions right">
    <span class="tag">Batch 2025 - 2026</span>
  </div>
</header>

<main>
  <!-- Landing / login -->
  <div id="landing" class="card login-box center">
    <div style="width:100%">
      <h2 style="margin:0 0 8px 0;color:var(--deep)">Welcome! Please enter the code.</h2>
      <p class="muted">Enter your access code to continue.</p>
      <div style="margin-top:12px" class="grid">
        <label for="accessCode">Access code</label>
        <input id="accessCode" placeholder="Enter code" autocomplete="off">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="btnAccess">Enter</button>
          <button id="btnAdminQuick" class="btn-ghost small-muted">Admin Mode</button>
        </div>
        <p class="small-muted">No hints shown here on first load.</p>
      </div>
    </div>
  </div>

  <!-- GenMath Interface -->
  <div id="genmath" class="card hidden">
    <div style="display:flex;align-items:center;gap:12px">
      <h2 style="margin:0">Welcome to General Mathematics Grade Viewing Database</h2>
      <div class="right top-actions">
        <button class="logout-btn" id="btnLogoutGen">Logout</button>
        <button class="btn-ghost" id="btnAdminGen">Admin Mode</button>
      </div>
    </div>
    <p class="muted">Select your section and then enter your LRN to view your grade.</p>

    <div class="grid cols-2" style="margin-top:14px">
      <div class="card section-list">
        <h3>Sections</h3>
        <button data-section="Ember">11 – Ember (HUMSS)</button>
        <button data-section="Oasis">11 – Oasis (GAS)</button>
        <button data-section="Solstice">11 – Solstice (GAS)</button>
        <button data-section="Meadow">11 – Meadow (GAS)</button>
      </div>

      <div class="card">
        <div id="genmath-section-area">
          <h3 id="genmath-section-title">Choose a section</h3>
          <div id="genmath-list" style="margin-top:8px"></div>

          <div id="genmath-lrn-area" class="hidden">
            <label for="gen-lrn-input">Enter your LRN</label>
            <input id="gen-lrn-input" placeholder="LRN">
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="btnGenView">View Grade</button>
              <button id="btnGenBack" class="btn-ghost">Back</button>
            </div>
            <div id="genmath-individual" class="hidden" style="margin-top:12px"></div>
          </div>

        </div>
      </div>
    </div>

    <div class="admin-area hidden" id="gen-admin-area">
      <h3>Admin Spreadsheet - General Mathematics</h3>
      <p class="small-muted">Edit LRNs, names and grades for each section. Click Save Changes to persist.</p>
      <div style="overflow:auto;max-height:420px;margin-top:10px"><table id="gen-admin-table"><thead><tr><th>Section</th><th>LRN</th><th>Name</th><th>Grade</th></tr></thead><tbody></tbody></table></div>
      <div style="margin-top:8px">
        <button class="save-btn" id="saveGenData">Save Changes</button>
        <button class="btn-ghost" id="closeGenAdmin">Close Admin</button>
      </div>
    </div>
  </div>

  <!-- TatakSTEM Interface -->
  <div id="tatak" class="card hidden">
    <div style="display:flex;align-items:center;gap:12px">
      <h2 style="margin:0">Welcome to Grade-11 Aurora (STEM) Database</h2>
      <div class="right top-actions">
        <button class="logout-btn" id="btnLogoutTatak">Logout</button>
        <button class="btn-ghost" id="btnAdminTatak">Admin Mode</button>
      </div>
    </div>
    <p class="muted">Enter Learner's Reference Number to proceed.</p>

    <div style="margin-top:14px;max-width:720px">
      <label for="tatak-lrn">Learner's Reference Number (LRN)</label>
      <input id="tatak-lrn" placeholder="LRN">
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="btnTatakView">View Student</button>
        <button id="btnTatakAdminQuick" class="btn-ghost">Admin Mode</button>
      </div>

      <div id="tatak-individual" class="card hidden" style="margin-top:12px"></div>

      <div id="tatak-admin-area" class="admin-area hidden">
        <h3>Admin Spreadsheet - Grade 11 Aurora (STEM)</h3>
        <p class="small-muted">Edit LRNs, names and grades. Final average computed automatically. Click Save Changes to persist.</p>
        <div style="overflow:auto;max-height:520px;margin-top:10px">
          <table id="tatak-admin-table">
            <thead>
              <tr>
                <th>LRN</th><th>Name</th>
                <th>Earth Science</th><th>General Mathematics</th><th>Oral Communication</th>
                <th>21st Century Lit</th><th>Intro to Philo</th><th>Komunikasyon</th>
                <th>Media & Info</th><th>PhysEd</th><th>Pre-Calculus</th><th>Final Average</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div style="margin-top:8px">
          <button class="save-btn" id="saveTatakData">Save Changes</button>
          <button class="btn-ghost" id="closeTatakAdmin">Close Admin</button>
        </div>
      </div>

    </div>
  </div>

  <footer class="card">
    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <strong>Dimasalang National High School</strong> — Student Portal demo
        <div class="small-muted">First Quarter • School Year 2025-2026</div>
      </div>
      <div style="margin-left:auto" class="small-muted">
        Note: Edits persist to your browser. For cross-device real-time syncing, enable a backend (instructions available).
      </div>
    </div>
  </footer>
</main>

<script>
/* =========================
   DATA: Preload all students
   ========================= */

// GEN MATH: structured by sections (as arrays of objects)
const defaultGenData = {
  Ember: [
    ["113597140014","AFABLE,CLARENS ANTIPOLO",74],
    ["113610140002","ALFORTE,RANNEL JOHN BALDEO",78],
    ["113606140068","ATABAY,JURODS BASAS",75],
    ["113606140041","CAGATIN,MARC JAY MARFIL",75],
    ["113606140051","CAPELLAN,JAMES ROLLY TOLENTINO",77],
    ["113606140046","CASTOR,KENNY RICH SALONDAGA",82],
    ["120868140083","GERVACIO,CZECH NAZARINE DINGAL",80],
    ["113951140024","GIMANG,BABY NIÑO VAFLOR",94],
    ["113943140021","GUIOGUIO,WINNARD KENT DALANON",88],
    ["113604140035","LETADA,R-JAY VILLAMOR",75],
    ["113712140015","TAMAYO,RENZ IVAN FUENTES",75],
    ["113606140183","VILLAMIN,JAMES JAHRED GUIRIBA",84],
    ["113606140185","VISDA,MATTHEW JOSH BISNAR",78],
    ["113606140113","ABAÑO,JESSA MAE ALICANTE",75],
    ["113612120033","AFABLE,NOVIE EMPAS",78],
    ["113951140037","ALORAN,MARIA PRINCESS AMARO",79],
    ["113606140124","ARROYO,KIMBERLY MOTITA",79],
    ["113606140126","ATABAY,JEAN ESCARO",86],
    ["113606140128","ATABAY,MARY CLAIRE GADIANA",84],
    ["113606150115","CAJEGAS,BENNIE MARIE CAPELLAN",81],
    ["136836140494","CAPELLAN,PRESCILLA ENATE",80],
    ["113606150071","CARILLO,IRISH MITRA",81],
    ["113610140012","CLORES,JOJIELYN ARAGON",82],
    ["113786140045","DELAVIN,CHENKIE CASIO",83],
    ["113606140144","DERLA,PRINCESS MAE SORIANO",85],
    ["103871140036","ESCALA,SCARLETTE SORIANO",88],
    ["113605140032","GARCIA,ANALYN TAMAYO",90],
    ["113610140016","LOZADA,NECEL JOY BULALAQUE",91],
    ["113604140052","NAGA,JAMIE LOREN TINAY",85],
    ["113606140164","ORIAS,TRISHA JANE NUÑEZ",81],
    ["113603140010","PABILANDO,JHOANNA VILLANTES",89],
    ["113606140160","PEÑARANDA,JAN MONICQUE ESPARRAGO",88],
    ["113606140178","ROBISO,ANDREA ATENDIDO",75],
    ["113605140039","SANCHEZ,DIANNE PATRICIA BERGADO",93],
    ["113504140033","TORRENUEVA,PRINCESS GEMINO",85],
    ["113606140161","VALLERAS,ROSELYN JERUSALEM",79]
  ],
  Oasis: [
    ["113606140050","Arimbuyutan, Nhel John Elyson A.",76],
    ["113602140005","Belarmino, Mark Dm H.",83],
    ["113606140060","Canete, Jolit Z.",78],
    ["113597140071","Diaz, Jethro L.",90],
    ["113613140004","Ecita, Lorince D.",76],
    ["113613140005","Igloso, Jerry Jr. C.",80],
    ["113617140031","Mahayag, Kyle",85],
    ["113604140036","Mahinay, Romel C.",81],
    ["113606140074","Manlangit, Lester C.",88],
    ["113615140011","Minggoy, John Mark V.",75],
    ["113605130037","Ramirez, Jielo A.",77],
    ["113604140042","Serafin, Reynald P.",70],
    ["136838140101","Ubac, Michael John M.",79],
    ["113606150124","Alforque, Anniver C.",75],
    ["113615140014","Aplacador, Arnie",77],
    ["113614140016","Apues, Marjorie A.",75],
    ["113606140129","Arizobal, Jenny P.",75],
    ["113606140088","Atizado, Princess Odesa P.",81],
    ["113951140053","Bandol, Loida A.",77],
    ["110282140176","Baring, Kristine M.",81],
    ["113599140015","Baring, Lanilyn A.",90],
    ["113606140143","Bayagosa, Esiel V.",76],
    ["113606140139","Caones, Cynde M.",82],
    ["113597140019","Catarinin, Victoria M.",81],
    ["113612140024","Etang, Kristine Rein Lara",80],
    ["113617140002","Francisco, Emmalyn E.",81],
    ["113613140019","Jubay, Jeann M.",74],
    ["123456789012","Lerit, Sassy Liane A.",70],
    ["113597140053","Luzong C. Nancy",86],
    ["113786140055","Mahinay, Gella",77],
    ["113597120160","Moreno, Jenny A.",75],
    ["113606140177","Natural, Erika Joy P.",79],
    ["113606140114","Noda, Glyza B.",75],
    ["113604140050","Orbes, Annjean B.",78],
    ["113613140016","Paghunasan, Shery-Ann T.",83],
    ["113606140115","Paran, Ronalyn D.",81],
    ["113951140046","Pascua, Danica A.",78],
    ["113951140086","Presilda, Janna Shane R.",78],
    ["113606140116","Ramirez, Jendy V.",80],
    ["113597140027","Rupa, Clavel O.",78]
  ],
  Solstice: [
    ["113612140003","AVILA,GIAN JOSH RAYMUNDO",76],
    ["113605130028","BELEN,JACKPHILLIP MENDERO",73],
    ["110108140048","BERRES,GEIAN CARLO RONDA",75],
    ["136524150592","CABRALES,AL FRANCIS AFABLE",78],
    ["113606140044","CARMEN,ERNESTO JR BERDIN",73],
    ["113606130133","COSTE,IGNACIO III ABAYON",73],
    ["113606110055","DEL MUNDO,JUSTINE PABATANG",74],
    ["109156150106","DELA CRUZ,JOHN KYLE -",76],
    ["113602130016","DOCUSIN,GIAN SOCITO",78],
    ["113954130030","ERENIA,KIM OCHEA",73],
    ["113597140011","FLORES,DAVE RABUYA",75],
    ["113604120065","LIBAY,JOSHUA VILLAMAR",77],
    ["113602140012","LUCENESIO,MARK JUSTIN ETAOC",73],
    ["113613130008","LUGANA,JADE IGLOSO",70],
    ["113606140099","LUZONG,BRENT KEVIN ARIZOBAL",80],
    ["113608110042","MALANA,GEHARD ADIGUE",81],
    ["113614140009","MONTECALVO,JOJIE AREGLADO",75],
    ["113612140020","TAMAYO,JOHN LESTER BELARMINO",75],
    ["104753140051","TOROY,DAVE ESPEJON",76],
    ["136477140516","TRINIDAD,JOHN WAYNE LUTCHE",73],
    ["113603140006","TUMANGAN,NHOAH BUJAWE",75],
    ["113606140119","ALIÑO,JEAN BENARO",73],
    ["113597140076","ARCUENO,AMANDA ANDRINO",84],
    ["113606140123","ARMA,ROCHELLE COSTE",74],
    ["113612140023","BARRUGA,RICHEL SOQUESO",73],
    ["113613140012","BRUSAS,JESSEL CAPALAR",81],
    ["113608120068","CANTORIA,JIZEL AMARO",73],
    ["113613140013","CAPALAR,RICHELYN CABAIS",80],
    ["113602140021","CARASICAS,SUSAN ANABE",74],
    ["113606140093","COLIBAO,ALEYAH ARCUENO",76],
    ["113610140013","ESCOTE,ROMA MAE MONCADA",73],
    ["113604140046","FRANCISCO,ANIELYN PALANAS",76],
    ["113605140033","GARCIA,SHIELA MAE BARILE",74],
    ["113606140150","GESTIADA,JULIA JANE IGNACIO",75],
    ["113606130227","MADERA,JERECA VERDIDA",73],
    ["113951130094","RICARTE,SHEILA MAE ESQUILONA",75],
    ["113612140027","ROMBAIZ,ROSALYN ADIGUE",73],
    ["113617140028","SALUNDAGA,JOSEL ALMOGUERA",75],
    ["113597140065","SANCHEZ,JESEL ARCUENO",73],
    ["113612140028","TAMAYO,PRINCESS HANNAH YLARAN",75]
  ],
  Meadow: [
    ["113610130009","ARRANGUEZ,MARK LEO ALFORTE",73],
    ["113956130022","BOGABIL,ALDIN LUMALANG",76],
    ["113602140017","CABAGUE,MIGUEL VIDA",75],
    ["113604140006","CABINTOY,JEROME CASIDSID",73],
    ["113602120010","CARASICAS,JEVAN ANABE",76],
    ["113605140007","DELA CRUZ,JHONNY FRANCISCO",75],
    ["113604140007","FLORES,JEM VASQUEZ",77],
    ["113605140012","MANANGAT,ERIC MENEL",76],
    ["113604140038","MITRA,CYRIL JOHN ESTRADA",75],
    ["113610140006","MONCADA,RON MART ESCOTE",76],
    ["113606140169","PARAGUYA,GERALD ESCARAN",74],
    ["113605140017","PINOTE,JAMES ABLAS",76],
    ["113606140181","RAMIREZ,RONIE MARK MENDOZA",75],
    ["113606140182","TANA,FRANCE HERMOSA",73],
    ["113613130013","URBANO,JOHN CARLO CAPELLAN",90],
    ["113612110001","ABAD,JUVYMAE BARRUGA",""],
    ["113610140008","ADORNA,CHARISA REBUJAS",75],
    ["113610140009","ALFORTE,MERYL JOY CAÑELAS",75],
    ["113597130044","ARCUENO,JENELYN PRESILDA",73],
    ["113605140023","ATIBAGOS,CRISHELLE FLORES",74],
    ["113610140010","BADIANA,MARIAN ARCON",73],
    ["113613130017","BILARMINO,RAYCEL LATAGAN",74],
    ["113610140011","BOGNOT,KIMBERLY ARAGON",73],
    ["113596120049","CAADLAWON,BELIZA BOHOL",75],
    ["113604140012","CARIÑO,DANICE ARQUIO",75],
    ["113606140147","CLEMENTE,MAURENE NICDAO",77],
    ["165510141544","COLLADO,HANNAH OSABEL",72],
    ["120741140026","CONTREDAS,CRISTINE LABATETE",74],
    ["113606140094","COSTE,GECEL TABOR",74],
    ["113608140014","CUIZON,JUNALYN ABELINDE",75],
    ["113942140018","DAO,LEIAN CARILLO",75],
    ["113612130037","DELA PEÑA,CHARLENE GAVIOLA",77],
    ["113606140096","DELOS SANTOS,LUJIL BELO",75],
    ["113597140021","ECITA,CHARMAE CAÑELAS",77],
    ["113597140077","LUCENESIO,ANGELICA VEPINOSA",76],
    ["113606140175","MAGLASANG,DANIELA COLUMNA",81],
    ["113617130046","MATERDAN,JESALYN TAMBOBOY",72],
    ["113606140118","RAYMUNDO,RHEA BANDOL",76],
    ["113605140038","SAMPAGA,JESSICA VILLAR",74]
  ]
};

// TATAK STEM: 32 students (list and 9 subject grades each).
const tatakStudents = [
  ["113797140007","Alutaya, MJ O."],
  ["113604140025","Aparente, Austin Jolf S."],
  ["113604140026","Arizobal, Robert Jules O."],
  ["113606150076","Atacador, Rey Kenneth C."],
  ["113606130113","Capellan, Kian Carl N."],
  ["113602140018","Delara, Jhonpyu A."],
  ["113602140008","Delara, Joeren Joules O."],
  ["113606150001","Dilao, Mark Lawrence P."],
  ["113606140061","Gabelo, Yeshuah Ashliegh B."],
  ["113606150116","Gamba, Renzell Wen G."],
  ["113951140031","Manlapaz, Mark Laurence B."],
  ["113606140170","Paraguya, Josua E."],
  ["113605140018","Piodos, John Errol M."],
  ["113612140017","Raymundo, Kyle Nathan M."],
  ["113597140007","Resma, Lenard B."],
  ["113599140008","Retuerto, Remark Fel R."],
  ["113606140109","Valle, Jahn Aj Vhin T."],
  ["113606140130","Almero, Mikaela Mildred D."],
  ["113606140132","Arizala, Rain A."],
  ["113786140015","Atega, Dianne Ashly M."],
  ["113608140025","Cabrera, Wenchie P."],
  ["113606140142","Cervantes, Nica A."],
  ["113589140014","Edem, Jeramie M."],
  ["113606140173","Huelva, Jelianne S."],
  ["113597140060","Ibañez, Carmela O."],
  ["113597140060","Jores, Cristel B."],
  ["113597140026","Malunes, Fricel Blaze A."],
  ["113599140030","Pelayo, Trecia Faith C."],
  ["402104150245","Peteros, Lhola Belle E."],
  ["113677130163","Salazar, Shane A."],
  ["113609140024","Tagbacaola, Irene A."],
  ["113782140023","Tamayo, Mary Antoniette A."]
];

// Provided subject-grade arrays (in the order the user provided). We'll map them accordingly.
// Order of subjects the user asked for: Earth Science, General Mathematics, Oral Communication, 21st Century Lit, Intro to Philo, Komunikasyon, Media & Info, Physical Education, Pre – Calculus
// But the user gave grade lists in this order: Media & Info Lit, Intro to Philo, General Mathematics, Komunikasyon, Oral communication, Pre-calculus, Science, 21st century lit, Physical education
// So we must re-map to the requested order.

const grades_media = [96,92,92,96,89,95,95,95,93,90,91,91,96,88,92,94,93,94,93,86,95,95,81,95,95,93,94,83,93,95,96,95];
const grades_philo = [91,84,86,88,85,87,82,87,85,85,85,82,90,84,85,88,84,79,88,84,88,87,79,89,86,89,91,85,88,89,93,93];
const grades_genmath = [89,86,91,91,85,92,92,94,89,87,88,86,92,86,94,95,95,92,90,84,94,92,84,92,89,90,94,84,92,91,96,97];
const grades_kom = [94,92,91,92,86,94,94,90,93,88,87,85,92,87,93,93,90,90,92,90,94,96,87,94,87,93,92,89,92,92,95,93];
const grades_oral = [95,96,94,94,96,96,95,94,95,96,95,93,96,90,94,95,95,95,94,91,97,95,87,94,95,95,97,90,95,96,96,95];
const grades_precalc = [91,88,93,90,87,90,90,94,89,87,89,88,90,87,90,95,94,87,87,85,91,91,84,92,85,95,92,88,92,94,94,96];
const grades_science = [96,92,92,96,89,95,95,95,93,90,91,91,96,88,92,94,93,94,93,86,95,95,81,95,95,93,94,83,93,95,96,95];
const grades_21st = [95,95,94,97,91,95,94,94,95,94,95,92,95,94,94,95,90,89,96,92,96,95,85,96,80,94,96,87,95,97,96,96];
const grades_pe = [94,90,96,96,92,96,94,89,95,92,89,94,93,91,90,91,91,89,94,90,95,89,85,92,89,91,89,82,92,90,89,93];

// Build Tatak data list of objects
const defaultTatakData = tatakStudents.map((s, idx) => {
  // Map to requested order: Earth Science, General Mathematics, Oral Communication, 21st Century Lit, Intro to Philo, Komunikasyon, Media & Info, Physical Education, Pre-Calculus
  const earth = grades_science[idx];
  const gen = grades_genmath[idx];
  const oral = grades_oral[idx];
  const lit21 = grades_21st[idx];
  const philo = grades_philo[idx];
  const kom = grades_kom[idx];
  const media = grades_media[idx];
  const phys = grades_pe[idx];
  const precalc = grades_precalc[idx];

  // final average computed as mean of numeric subjects
  const subjectsArr = [earth, gen, oral, lit21, philo, kom, media, phys, precalc];
  const numeric = subjectsArr.filter(v => typeof v === 'number' && !isNaN(v));
  const avg = numeric.length ? (numeric.reduce((a,b)=>a+b,0)/numeric.length) : null;

  return {
    lrn: s[0],
    name: s[1],
    subjects: {
      "Earth Science": earth,
      "General Mathematics": gen,
      "Oral Communication": oral,
      "21st Century Literature": lit21,
      "Introduction to Philosophy": philo,
      "Komunikasyon at Pananaliksik": kom,
      "Media and Information Literacy": media,
      "Physical Education and Health": phys,
      "Pre-Calculus": precalc
    },
    finalAverage: avg !== null ? roundTo(avg, 6) : ""
  };
});

/* ================
   Utility functions
   ================ */
function qs(sel){return document.querySelector(sel)}
function qsa(sel){return Array.from(document.querySelectorAll(sel))}
function saveToStorage(key, data){localStorage.setItem(key, JSON.stringify(data))}
function loadFromStorage(key, fallback){try{const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback}catch(e){return fallback}}
function roundTo(num, decimals){ if(num===null || num===undefined) return ""; const p = Math.pow(10, decimals||2); return Math.round((+num) * p)/p; }
function calcAverageFromObj(subjObj){
  const vals = Object.values(subjObj).filter(v => v !== "" && v !== null && !isNaN(Number(v))).map(Number);
  if(!vals.length) return "";
  return roundTo(vals.reduce((a,b)=>a+b,0)/vals.length, 6);
}
function honorsText(avg){
  if(avg === "" || avg === null || isNaN(avg)) return "";
  const a = Number(avg);
  if(a >= 97.5555555 && a <= 100) return "WITH HIGHEST HONORS";
  if(a >= 94.5555555555 && a <= 97.4444444444) return "WITH HIGH HONORS";
  if(a >= 89.544444 && a <= 94.4444444444) return "WITH HONORS";
  return "";
}

/* =======================================================
   Load or initialize databases (localStorage-backed)
   ======================================================= */
let genData = loadFromStorage('genmath-db', defaultGenData);
let tatakData = loadFromStorage('tatak-db', defaultTatakData);

/* ===========================
   UI wiring and behavior
   =========================== */

const landing = qs('#landing');
const btnAccess = qs('#btnAccess');
const accessInput = qs('#accessCode');
const genmathView = qs('#genmath');
const tatakView = qs('#tatak');

btnAccess.addEventListener('click', handleAccess);
accessInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleAccess(); });

qs('#btnAdminQuick').addEventListener('click', ()=>{ promptAdminPin('both'); });

function handleAccess(){
  const code = (accessInput.value||"").trim();
  if(!code) return alert("Please enter a code.");
  if(code === 'GenMath2025'){
    showGenMath();
  } else if(code === 'TatakSTEM'){
    showTatak();
  } else {
    alert('Invalid code. Please check and try again.');
  }
  accessInput.value = "";
}

/* -----------------------------
   GEN MATH: sections & lookup
   ----------------------------- */
function showGenMath(){
  landing.classList.add('hidden');
  genmathView.classList.remove('hidden');
  tatakView.classList.add('hidden');
  hideAllAdminAreas();
  qs('#genmath-section-title').textContent = "Choose a section";
  qs('#genmath-list').innerHTML = "";
  qs('#genmath-lrn-area').classList.add('hidden');
  qs('#genmath-individual').classList.add('hidden');
}

qsa('.section-list button').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    const section = btn.getAttribute('data-section');
    renderGenSection(section);
  })
});

function renderGenSection(section){
  qs('#genmath-section-title').textContent = "Section: " + section;
  const listEl = qs('#genmath-list');
  listEl.innerHTML = '';
  const arr = genData[section] || [];
  arr.forEach(s=>{
    const row = document.createElement('div');
    row.className='student-row';
    row.innerHTML = `<div>
        <div class="name">${s[1]}</div>
        <div class="lrn small-muted">LRN: ${s[0]}</div>
      </div>
      <div class="actions">
        <button class="btn-ghost small" data-lrn="${s[0]}">View</button>
      </div>`;
    listEl.appendChild(row);
  });
  qs('#genmath-lrn-area').classList.remove('hidden');

  // remember selected section for lookup
  qs('#genmath-lrn-area').dataset.section = section;
}

qs('#btnGenView').addEventListener('click', ()=> {
  const lrn = (qs('#gen-lrn-input').value||"").trim();
  const section = qs('#genmath-lrn-area').dataset.section;
  if(!section) return alert('Choose a section first.');
  if(!lrn) return alert('Enter your LRN.');
  showGenStudent(section, lrn);
});
qs('#btnGenBack').addEventListener('click', ()=> {
  qs('#genmath-lrn-area').classList.remove('hidden');
  qs('#genmath-individual').classList.add('hidden');
  qs('#gen-lrn-input').value='';
});
qs('#genmath-list').addEventListener('click', (e)=>{
  if(e.target.tagName==='BUTTON'){
    const lrn = e.target.dataset.lrn;
    const section = qs('#genmath-lrn-area').dataset.section;
    if(section) showGenStudent(section, lrn);
  }
});

function showGenStudent(section, lrn){
  const arr = genData[section] || [];
  const found = arr.find(r=>String(r[0])===String(lrn));
  if(!found) return alert('LRN not found in this section.');
  const name = found[1];
  const grade = found[2];
  const individual = qs('#genmath-individual');
  individual.innerHTML = `
    <h3>${name}</h3>
    <div class="small-muted">LRN: ${found[0]}</div>
    <div style="margin-top:10px">
      <strong>General Mathematics</strong>: <span style="font-size:1.15rem">${grade !== "" ? grade : '<em>No grade yet</em>'}</span>
    </div>
    <div style="margin-top:12px" class="${(grade>=75)?'msg-pass':'msg-fail'}">
      ${grade !== "" ? ((grade>=75) ? "Congratulations! You passed the subject. Continue improving!" : "May second quarter pa, pwedeng-pwede pang bumawi!") : ""}
    </div>
    <div class="first-quarter">Congratulations! You survived the First Quarter of School Year 2025-2026 — Sir Jerson</div>
    <div style="margin-top:12px"><button id="btnGenLogout" class="logout-btn">Logout</button></div>
  `;
  qs('#genmath-lrn-area').classList.add('hidden');
  individual.classList.remove('hidden');
  qs('#btnGenLogout').addEventListener('click', ()=>{ logoutToLanding(); });
}

/* Admin for Gen Math */
qs('#btnAdminGen').addEventListener('click', ()=>promptAdminPin('gen'));
qs('#btnAdminQuick').addEventListener('click', ()=>promptAdminPin('both'));
function promptAdminPin(target){
  const pin = prompt('Enter admin passcode:');
  if(pin===null) return;
  if(pin === '675915'){
    if(target === 'gen' || target === 'both'){
      openGenAdmin();
    }
    if(target === 'tatak' || target === 'both'){
      openTatakAdmin();
    }
  } else {
    alert('Incorrect admin passcode.');
  }
}

function openGenAdmin(){
  qs('#gen-admin-area').classList.remove('hidden');
  qs('#genmath').classList.remove('hidden');
  qs('#genmath-section-area').classList.add('hidden');
  renderGenAdminTable();
}
qs('#closeGenAdmin').addEventListener('click', ()=> {
  qs('#gen-admin-area').classList.add('hidden');
  qs('#genmath-section-area').classList.remove('hidden');
});

function renderGenAdminTable(){
  const tbody = qs('#gen-admin-table tbody');
  tbody.innerHTML = '';
  Object.keys(genData).forEach(section=>{
    genData[section].forEach(row=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${escapeHtml(section)}</td>
        <td><input data-field="lrn" value="${escapeHtml(row[0])}"></td>
        <td><input data-field="name" value="${escapeHtml(row[1])}"></td>
        <td><input data-field="grade" value="${escapeHtml(row[2])}" class="grade"></td>`;
      tbody.appendChild(tr);
    })
  })
}
qs('#saveGenData').addEventListener('click', ()=> {
  // rebuild genData from table inputs
  const rows = Array.from(qs('#gen-admin-table tbody').querySelectorAll('tr'));
  const newGen = { Ember: [], Oasis: [], Solstice: [], Meadow: [] };
  rows.forEach(tr=>{
    const section = tr.children[0].textContent;
    const lrn = tr.querySelector('input[data-field="lrn"]').value.trim();
    const name = tr.querySelector('input[data-field="name"]').value.trim();
    const gradeRaw = tr.querySelector('input[data-field="grade"]').value.trim();
    const grade = gradeRaw === "" ? "" : Number(gradeRaw);
    if(!newGen[section]) newGen[section] = [];
    newGen[section].push([lrn, name, grade]);
  });
  genData = newGen;
  saveToStorage('genmath-db', genData);
  alert('Saved General Mathematics data to browser storage.');
});

/* -----------------------------
   TATAK: student view & admin
   ----------------------------- */

qs('#btnTatakView').addEventListener('click', ()=> {
  const lrn = (qs('#tatak-lrn').value||"").trim();
  if(!lrn) return alert('Enter your LRN.');
  showTatakStudent(lrn);
});
qs('#btnAdminTatak').addEventListener('click', ()=> promptAdminPin('tatak'));
qs('#btnTatakAdminQuick').addEventListener('click', ()=> promptAdminPin('tatak'));

function showTatak(){
  landing.classList.add('hidden');
  tatakView.classList.remove('hidden');
  genmathView.classList.add('hidden');
  hideAllAdminAreas();
}

function showTatakStudent(lrn){
  const student = tatakData.find(s=> String(s.lrn) === String(lrn));
  if(!student) return alert('LRN not found.');
  const area = qs('#tatak-individual');
  area.innerHTML = `
    <h3 style="margin:0">${escapeHtml(student.name)}</h3>
    <div class="small-muted" style="margin-bottom:8px">LRN: ${escapeHtml(student.lrn)}</div>
    <div><strong>Science, Technology, Engineering, and Mathematics Class Batch 2025 - 2026</strong></div>
    <div style="margin-top:10px;overflow:auto"><table><tbody>
      ${Object.entries(student.subjects).map(([sub, val]) => `<tr><td><strong>${escapeHtml(sub)}</strong></td><td>${val==="" ? '<em>No grade</em>' : escapeHtml(String(val))}</td></tr>`).join('')}
      <tr><td><strong>Final Average</strong></td><td><strong>${student.finalAverage !== "" ? student.finalAverage : "<em>Not computed</em>"}</strong></td></tr>
    </tbody></table></div>
    <div style="margin-top:12px" class="${(Number(student.finalAverage) >= 75)?'msg-pass':'msg-fail'}">
      ${ student.finalAverage !== "" ? ((Number(student.finalAverage) >= 75) ? "Congratulations! You passed the subject. Continue improving!" : "May second quarter pa, pwedeng-pwede pang bumawi!") : "" }
    </div>
    <div style="margin-top:8px">${ honorsText(student.finalAverage) ? `<div class="notice">${honorsText(student.finalAverage)}</div>` : "" }</div>
    <div class="first-quarter">Congratulations! You survived the First Quarter of School Year 2025-2026 — Sir Jerson</div>
    <div style="margin-top:10px"><button id="btnTatakLogout" class="logout-btn">Logout</button></div>
  `;
  area.classList.remove('hidden');

  qs('#btnTatakLogout').addEventListener('click', ()=>{ logoutToLanding(); });
}

/* Tatak Admin */
function openTatakAdmin(){
  qs('#tatak-admin-area').classList.remove('hidden');
  renderTatakAdminTable();
}
function renderTatakAdminTable(){
  const tbody = qs('#tatak-admin-table tbody');
  tbody.innerHTML = '';
  tatakData.forEach((stu, idx) => {
    const tr = document.createElement('tr');
    const s = stu;
    const subjects = s.subjects;
    tr.innerHTML = `
      <td><input data-field="lrn" value="${escapeHtml(s.lrn)}"></td>
      <td><input data-field="name" value="${escapeHtml(s.name)}" style="min-width:220px"></td>
      <td><input data-sub="Earth Science" class="grade" value="${escapeHtml(subjects['Earth Science'])||''}"></td>
      <td><input data-sub="General Mathematics" class="grade" value="${escapeHtml(subjects['General Mathematics'])||''}"></td>
      <td><input data-sub="Oral Communication" class="grade" value="${escapeHtml(subjects['Oral Communication'])||''}"></td>
      <td><input data-sub="21st Century Literature" class="grade" value="${escapeHtml(subjects['21st Century Literature'])||''}"></td>
      <td><input data-sub="Introduction to Philosophy" class="grade" value="${escapeHtml(subjects['Introduction to Philosophy'])||''}"></td>
      <td><input data-sub="Komunikasyon at Pananaliksik" class="grade" value="${escapeHtml(subjects['Komunikasyon at Pananaliksik'])||''}"></td>
      <td><input data-sub="Media and Information Literacy" class="grade" value="${escapeHtml(subjects['Media and Information Literacy'])||''}"></td>
      <td><input data-sub="Physical Education and Health" class="grade" value="${escapeHtml(subjects['Physical Education and Health'])||''}"></td>
      <td><input data-sub="Pre-Calculus" class="grade" value="${escapeHtml(subjects['Pre-Calculus'])||''}"></td>
      <td><input data-field="final" readonly value="${escapeHtml(String(s.finalAverage))}"></td>
    `;
    tbody.appendChild(tr);
  });
}

qs('#saveTatakData').addEventListener('click', ()=> {
  // rebuild tatakData from admin table
  const rows = Array.from(qs('#tatak-admin-table tbody').querySelectorAll('tr'));
  const newData = [];
  rows.forEach(tr=>{
    const lrn = tr.querySelector('input[data-field="lrn"]').value.trim();
    const name = tr.querySelector('input[data-field="name"]').value.trim();
    const subjNames = ["Earth Science","General Mathematics","Oral Communication","21st Century Literature","Introduction to Philosophy","Komunikasyon at Pananaliksik","Media and Information Literacy","Physical Education and Health","Pre-Calculus"];
    const subjObj = {};
    subjNames.forEach((sname, idx)=>{
      const inp = tr.querySelectorAll('input.grade')[idx];
      const valRaw = inp ? inp.value.trim() : "";
      subjObj[sname] = valRaw === "" ? "" : Number(valRaw);
    });
    const avg = calcAverageFromObj(subjObj);
    newData.push({ lrn, name, subjects: subjObj, finalAverage: avg !== "" ? roundTo(avg,6) : "" });
  });
  tatakData = newData;
  saveToStorage('tatak-db', tatakData);
  renderTatakAdminTable();
  alert('Saved TatakSTEM data to browser storage.');
});

qs('#closeTatakAdmin').addEventListener('click', ()=> {
  qs('#tatak-admin-area').classList.add('hidden');
});

/* Logout helper */
function logoutToLanding(){
  landing.classList.remove('hidden');
  genmathView.classList.add('hidden');
  tatakView.classList.add('hidden');
  hideAllAdminAreas();
  accessInput.focus();
}

/* Hide any admin areas */
function hideAllAdminAreas(){
  qs('#gen-admin-area').classList.add('hidden');
  qs('#tatak-admin-area').classList.add('hidden');
  qs('#genmath-section-area')?.classList?.remove('hidden');
}

/* Admin PIN prompt entry for when clicking "Admin Mode" in landing */
qs('#btnAdminQuick').addEventListener('click', ()=>{ promptAdminPin('both'); });

/* Utility: escape HTML for safety */
function escapeHtml(s){ if(s===undefined || s===null) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

/* Allow pressing Enter on some inputs to act */
qs('#gen-lrn-input').addEventListener('keydown', (e)=>{ if(e.key==='Enter') qs('#btnGenView').click(); });
qs('#tatak-lrn').addEventListener('keydown', (e)=>{ if(e.key==='Enter') qs('#btnTatakView').click(); });

/* Initialize landing */
(function init(){
  // if localStorage empty, seed defaults
  if(!localStorage.getItem('genmath-db')) saveToStorage('genmath-db', genData);
  if(!localStorage.getItem('tatak-db')) saveToStorage('tatak-db', tatakData);
})();
</script>

<!--
  NOTES & NEXT STEPS for cross-device real-time syncing:
  - Option A (recommended): Use Firebase (Realtime Database or Firestore).
      * Create Firebase project, enable Firestore or RTDB.
      * Paste your Firebase config here and implement simple GET/SET sync in the save & load functions.
  - Option B: Use Google Sheets as a backend (via Apps Script web app); requires publishing and CORS allowances.
  - If you'd like, I can:
      1) Add a Firebase integration scaffold to this file (you paste your Firebase config and it will work).
      2) Or convert this to use CSV import/export so you can quickly move data around.
-->

</body>
</html>
